<!DOCTYPE html>
<html>
<head>
	<style>
		#query {
			width: 90%%;
			font-size:14px
		}
		table, td {
			border: 1px solid black;
		}
	</style>
</head>
<body>
	<div>
		<button id="qbutton">query</button>
		<input type="text" id="query" value="start=5m-ago&m=sum:redis.latency{host=*}">
	</div>
	<div id="chart"></div>
	<table>
		<tr>
			<td>
			<h2>metrics by tag set</h2>
			{{range $q, $metrics := .Metric}}
				{{$q.A}}={{$q.B}}
				{{range $metric, $_ := $metrics}}
				<ul>
					<li><a href="#" class="metric">{{$metric}}{{`{`}}{{$q.A}}={{$q.B}}{{`}`}}</a></li>
				</ul>
				{{end}}
			{{end}}
			</td>
			<td>
				<h2>tag keys by metric</h2>
			{{range $q, $tagks := .Tagk}}
				{{$q}}
				{{range $tagk, $_ := $tagks}}
				<ul>
					<li><a href="#" class="metric">{{$q}}{{`{`}}{{$tagk}}=*{{`}`}}</a></li>
				</ul>
				{{end}}
			{{end}}
			</td>
			<td>
			<h2>tag values by metric and tag key</h2>
			{{range $q, $tagvs := .Tagv}}
				{{$q.A}}{{`{`}}{{$q.B}}=-{{`}`}}
				{{range $tagv, $_ := $tagvs}}
				<ul>
					<li><a href="#" class="metric">{{$q.A}}{{`{`}}{{$q.B}}={{$tagv}}{{`}`}}</a></li>
				</ul>
				{{end}}
			{{end}}
			</td>
		</tr>
	</table>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		google.load('visualization', '1.0', {'packages':['corechart']});
	</script>
	<script type="text/javascript">
	</script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>
		$('#qbutton').click(function() {
			var w = new google.visualization.ChartWrapper({
				chartType: 'LineChart',
				options: {
					width: 1000,
					height: 800,
					curveType: 'function'
				},
				dataSourceUrl: '/api/chart?' + $('#query').val(),
				containerId: 'chart'
			});
			w.draw();
		}).trigger('click');
		$(function() {
			$(document).on('click', '.metric', function() {
				$('#query').val('start=30m-ago&m=sum:' + $(this).text());
				$('#qbutton').trigger('click');
			});
		});
		$(document).keypress(function(e) {
			if (e.which == 13) {
				$('#qbutton').trigger('click');
			}
		});
	</script>
</body>
</html>